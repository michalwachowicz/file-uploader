<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      <%= locals.folder
        ? `${locals.folder.name} | ${locals.user.username} | File Uploader`
        : `${locals.user.username} | File Uploader`
      %>
    </title>
  </head>
  <body>
    <%- include('partials/header') %>

    <main>
      <aside>
        <button>New</button>

        <%- include('partials/folder-tree', { isRoot: true, allFolders, folderPath: typeof folderPath !== 'undefined' ? folderPath : [] }) %>
      </aside>

      <section>
        <nav aria-label="Breadcrumb" style="margin-bottom: 1rem;">
          <a href="/">Home</a>
          <% if (locals.breadcrumbs && breadcrumbs.length > 0) { %>
            <% breadcrumbs.forEach(function(crumb) { %>
              &nbsp;/&nbsp;<a href="/folder/<%= crumb.id %>"><%= crumb.name %></a>
            <% }) %>
          <% } %>
        </nav>

        <%- include('partials/folder-table', { folders, files }) %>
      </section>
    </main>

    <% if (locals.folderPath && locals.folderPath.length > 0) { %>
      <div id="folder-data" data-folder-path='<%- JSON.stringify(folderPath || []) %>' hidden></div>
    <% } %>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const el = document.getElementById('folder-data');
        if (!el) return;

        const folderPath = JSON.parse(el.dataset.folderPath || '[]');

        folderPath.forEach(folderId => {
          const details = document.querySelector(`details[data-folder-id="${folderId}"]`);
          if (details) details.open = true;
        });

        el.remove();
      });
    </script>
  </body>
</html>

